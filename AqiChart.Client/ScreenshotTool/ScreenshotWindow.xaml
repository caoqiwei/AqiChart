<Window x:Class="AqiChart.Client.ScreenshotTool.ScreenshotWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="截图" 
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        Loaded="Window_Loaded"
        KeyDown="Window_KeyDown"
        MouseDown="Window_MouseDown"
        MouseMove="Window_MouseMove"
        MouseUp="Window_MouseUp"
        MouseWheel="Window_MouseWheel"
        MouseDoubleClick="Window_MouseDoubleClick">

    <Window.Resources>
        
    </Window.Resources>

    <Grid x:Name="MainGrid">
        <!-- 截图区域 -->
        <Canvas x:Name="MainCanvas" Background="#01000000">
            <!-- 半透明遮罩层 -->
            <Rectangle x:Name="OverlayRect" 
                       Fill="#88000000" 
                       Canvas.Left="0" 
                       Canvas.Top="0"/>

            <!-- 选择区域（反色显示） -->
            <Rectangle x:Name="SelectionRect" 
                       Stroke="White"
                       StrokeThickness="1"
                       SnapsToDevicePixels="True">
                <Rectangle.Fill>
                    <VisualBrush>
                        <VisualBrush.Visual>
                            <Rectangle Fill="White">
                                <Rectangle.OpacityMask>
                                    <DrawingBrush>
                                        <DrawingBrush.Drawing>
                                            <DrawingGroup>
                                                <GeometryDrawing Brush="Black">
                                                    <GeometryDrawing.Geometry>
                                                        <RectangleGeometry Rect="0,0,1,1"/>
                                                    </GeometryDrawing.Geometry>
                                                </GeometryDrawing>
                                            </DrawingGroup>
                                        </DrawingBrush.Drawing>
                                    </DrawingBrush>
                                </Rectangle.OpacityMask>
                            </Rectangle>
                        </VisualBrush.Visual>
                    </VisualBrush>
                </Rectangle.Fill>
            </Rectangle>

            <!-- 选择区域边框 -->
            <Rectangle x:Name="BorderRect" 
                       Stroke="#FF0078D7"
                       StrokeThickness="1"
                       StrokeDashArray="4,2"
                       SnapsToDevicePixels="True"/>

            <!-- 编辑画布 -->
            <Canvas x:Name="DrawingCanvas" 
                    Background="Transparent"
                    MouseDown="DrawingCanvas_MouseDown"
                    MouseMove="DrawingCanvas_MouseMove"
                    MouseUp="DrawingCanvas_MouseUp"/>

            <!-- 尺寸提示 -->
            <Border x:Name="SizeTip" 
                    Style="{StaticResource SizeLabelStyle}"
                    Canvas.ZIndex="100"
                    Visibility="Collapsed">
                <TextBlock x:Name="SizeTipText" 
                           Foreground="White" 
                           FontSize="12"
                           FontWeight="Bold"/>
            </Border>

            <!-- 坐标提示 -->
            <Border x:Name="PositionTip" 
                    Style="{StaticResource SizeLabelStyle}"
                    Canvas.ZIndex="100"
                    Visibility="Collapsed">
                <TextBlock x:Name="PositionTipText" 
                           Foreground="White" 
                           FontSize="12"/>
            </Border>
        </Canvas>

        <!-- 编辑工具栏 -->
        <Border x:Name="ToolbarBorder"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Background="White"
                BorderBrush="#CCCCCC"
                BorderThickness="1"
                CornerRadius="4"
                Padding="8"
                Margin="10"
                Visibility="Collapsed">
            <StackPanel Orientation="Horizontal">
                <!-- 完成按钮 -->
                <Button x:Name="FinishButton"
                        Content="完成"
                        Width="70"
                        Height="32"
                        Background="#0078D7"
                        Foreground="White"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Click="FinishButton_Click"
                        Margin="0,0,8,0"
                        Cursor="Hand"/>

                <Separator Width="8" Opacity="0"/>

                <!-- 编辑工具 -->
                <!-- 矩形 -->
                <Button x:Name="RectToolButton"
                        ToolTip="矩形 (R)"
                        Style="{StaticResource SelectedToolButtonStyle}"
                        Click="RectToolButton_Click">
                    <Grid Width="20" Height="20">
                        <Rectangle Stroke="Black" 
                                   StrokeThickness="2"
                                   Width="16" 
                                   Height="16"/>
                    </Grid>
                </Button>

                <!-- 圆形 -->
                <Button x:Name="EllipseToolButton"
                        ToolTip="圆形 (C)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="EllipseToolButton_Click">
                    <Grid Width="20" Height="20">
                        <Ellipse Stroke="Black" 
                                 StrokeThickness="2"
                                 Width="16" 
                                 Height="16"/>
                    </Grid>
                </Button>

                <!-- 直线 -->
                <Button x:Name="LineToolButton"
                        ToolTip="直线 (L)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="LineToolButton_Click">
                    <Grid Width="20" Height="20">
                        <Line X1="4" Y1="16" X2="16" Y2="4"
                              Stroke="Black" 
                              StrokeThickness="2"/>
                    </Grid>
                </Button>

                <!-- 箭头 -->
                <Button x:Name="ArrowToolButton"
                        ToolTip="箭头 (A)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="ArrowToolButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 4,16 L 16,4 M 12,4 L 16,8 M 16,4 L 12,8"
                              Stretch="Uniform"/>
                    </Grid>
                </Button>

                <!-- 画笔 -->
                <Button x:Name="BrushToolButton"
                        ToolTip="画笔 (B)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="BrushToolButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 4,16 Q 8,12 11,14 Q 14,16 16,12"
                              Stretch="Uniform"/>
                    </Grid>
                </Button>

                <!-- 文字 -->
                <Button x:Name="TextToolButton"
                        ToolTip="文字 (T)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="TextToolButton_Click">
                    <Grid Width="20" Height="20">
                        <TextBlock Text="A"
                                   FontWeight="Bold"
                                   FontSize="16"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Button>

                <!-- 马赛克 -->
                <Button x:Name="MosaicToolButton"
                        ToolTip="马赛克 (M)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="MosaicToolButton_Click">
                    <Grid Width="20" Height="20">
                        <Rectangle Width="16" Height="16">
                            <Rectangle.Fill>
                                <DrawingBrush Viewport="0,0,4,4" 
                                              ViewportUnits="Absolute" 
                                              TileMode="Tile">
                                    <DrawingBrush.Drawing>
                                        <GeometryDrawing Brush="Black">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="0,0,2,2"/>
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                    </DrawingBrush.Drawing>
                                </DrawingBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                </Button>

                <Separator Width="8" Opacity="0"/>

                <!-- 颜色选择 -->
                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <Button x:Name="RedColorButton"
                            Style="{StaticResource SelectedColorButtonStyle}"
                            Background="Red"
                            Click="RedColorButton_Click"/>

                    <Button x:Name="BlueColorButton"
                            Style="{StaticResource ColorButtonStyle}"
                            Background="Blue"
                            Click="BlueColorButton_Click"/>

                    <Button x:Name="GreenColorButton"
                            Style="{StaticResource ColorButtonStyle}"
                            Background="Green"
                            Click="GreenColorButton_Click"/>

                    <Button x:Name="YellowColorButton"
                            Style="{StaticResource ColorButtonStyle}"
                            Background="Yellow"
                            Click="YellowColorButton_Click"/>

                    <Button x:Name="BlackColorButton"
                            Style="{StaticResource ColorButtonStyle}"
                            Background="Black"
                            Click="BlackColorButton_Click"/>

                    <Button x:Name="WhiteColorButton"
                            Style="{StaticResource ColorButtonStyle}"
                            Background="White"
                            Click="WhiteColorButton_Click"/>
                </StackPanel>

                <Separator Width="8" Opacity="0"/>

                <!-- 粗细选择 -->
                <ComboBox x:Name="ThicknessComboBox" 
                         Width="60"
                         Height="32"
                         SelectedIndex="2"
                         SelectionChanged="ThicknessComboBox_SelectionChanged">
                    <ComboBoxItem>1</ComboBoxItem>
                    <ComboBoxItem>2</ComboBoxItem>
                    <ComboBoxItem>3</ComboBoxItem>
                    <ComboBoxItem>5</ComboBoxItem>
                    <ComboBoxItem>8</ComboBoxItem>
                </ComboBox>

                <Separator Width="8" Opacity="0"/>

                <!-- 操作按钮 -->
                <Button x:Name="UndoButton"
                        ToolTip="撤销 (Ctrl+Z)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="UndoButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 15,5 L 5,10 L 15,15"
                              Stretch="Uniform"/>
                    </Grid>
                </Button>

                <Button x:Name="RedoButton"
                        ToolTip="重做 (Ctrl+Y)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="RedoButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 5,5 L 15,10 L 5,15"
                              Stretch="Uniform"/>
                    </Grid>
                </Button>

                <Button x:Name="ClearButton"
                        ToolTip="清空"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="ClearButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 5,5 L 15,15 M 15,5 L 5,15"
                              Stretch="Uniform"/>
                    </Grid>
                </Button>

                <Separator Width="8" Opacity="0"/>

                <!-- 保存选项 -->
                <Button x:Name="SaveButton"
                        ToolTip="保存 (Ctrl+S)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="SaveButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 5,17 L 5,12 L 15,12 L 15,17 M 7,10 L 13,10 L 15,5 L 5,5 L 7,10"
                              Stretch="Uniform"
                              Fill="Transparent"/>
                    </Grid>
                </Button>

                <Button x:Name="CopyButton"
                        ToolTip="复制到剪贴板 (Ctrl+C)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="CopyButton_Click">
                    <Grid Width="20" Height="20">
                        <Rectangle Stroke="Black" 
                                   StrokeThickness="2"
                                   Width="14" 
                                   Height="14"/>
                        <Rectangle Stroke="Black" 
                                   StrokeThickness="2"
                                   Width="14" 
                                   Height="14"
                                   Margin="4,4,0,0"/>
                    </Grid>
                </Button>

                <Button x:Name="CancelButton"
                        ToolTip="取消 (ESC)"
                        Style="{StaticResource ToolButtonStyle}"
                        Click="CancelButton_Click">
                    <Grid Width="20" Height="20">
                        <Path Stroke="Black" 
                              StrokeThickness="2"
                              Data="M 5,5 L 15,15 M 15,5 L 5,15"
                              Stretch="Uniform"/>
                    </Grid>
                </Button>
            </StackPanel>
        </Border>

        <!-- 底部提示 -->
        <Border x:Name="HintBorder"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                Background="#80000000"
                CornerRadius="4"
                Padding="12,6"
                Margin="0,0,0,30"
                Visibility="Visible">
            <StackPanel>
                <TextBlock Text="提示" 
                           Foreground="White" 
                           FontWeight="Bold"
                           HorizontalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                    <TextBlock Text="拖动鼠标选择区域" 
                               Foreground="White" 
                               Margin="0,0,12,0"/>
                    <TextBlock Text="ESC: 取消" 
                               Foreground="White" 
                               Margin="0,0,12,0"/>
                    <TextBlock Text="Enter: 确认" 
                               Foreground="White"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</Window>